---
title: "Introduction à Docker"
author: "FinistR"
date: '2022-08-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Sources

-  [Le tuto de Colin Fay](https://colinfay.me/docker-r-reproducibility/)
- Le blog [Putain de Code](https://putaindecode.io/articles/introduction-a-docker/)

### Objectif

Le principe est de créer un **environnement contrôlé** (appelé container). On entend par environnement 

- le système d'exploitation (Linux dans une version donnée), 
- la version du language (R 2.3.0 par exemple)
- les packages utiles dans une version donnée

### Quand cela est-il utile? 

C'est utile si j'ai écrit des codes/packages/scripts et que je veux 
- les faire tourner sur une autre machine mais ayant les mêmes caractéristiques que les miennes (si tant est que je ne sois pas sousWindows)
- tester mes programmes sur d'autres versions de Linux/R. 


### Installation


D'abord il faut installer docker, c'est à dire le programme qui va nous service à créer le conteneur. 

 - Sous Linux, l'instruction `sudo snap install docker`  fonctionne. 
Des instructions plus détaillées sont fournies [ici](https://www.simplilearn.com/tutorials/docker-tutorial/how-to-install-docker-on-ubuntu)

 - Sous Windows.... * to complete* 

Avec cette installation, aucune interface n'est fournie. Il faudrait lancer docker en ligne de commande et éditer les fichiers dans un éditeur quelconque. 

### Créer son docker

Créer un docker consiste à créer un fichier texte (sans extension) docker contenant la "recette" de l'image. Cette recette commence généralement par faire appel à une image déjà prête puis à la modifier. L'appel à l'image existante se fait via l'instruction FROM, les modifications se feront via des instructions RUN. Un exemple (tiré du blog de Colin Fay) :

FROM rocker/r-ver:3.4.4
RUN mkdir /home/analysis
RUN R -e "options(repos = \
  list(CRAN = 'http://mran.revolutionanalytics.com/snapshot/2019-01-06/')); \
  install.packages('tidystringdist')"
  
La première ligne fait appel à une image qui va contenir la version 3.4.4 de R (dans un environnement linux). Cette image se trouve dans un catalogue d'images disponibles en ligne, cf le paragraphe suivant. La deuxième ligne permet, dans l'environnement virtuel (le container), de créer un répertoire *analysis* à la racine, et la troisième d'installer le package R "tydistringdist" dans R.    

## Où trouver un Docker déjà prêt

- Il existe 


## Comment modifier un docker

Les commandes RUN et CMD permettent de modifier une image existante en rajpoutant des instructions (créer des objets dans l'environnement virtuel, rajouter des packages, installer d'autres logiciels, créer un pont entre l'environnement virtuel et son répertoire local pour récupérer des objets créés dans l'environnement virtuel)


## Comment exécuter ses propres codes dans un dockerR 

## 







## Including Plots

  