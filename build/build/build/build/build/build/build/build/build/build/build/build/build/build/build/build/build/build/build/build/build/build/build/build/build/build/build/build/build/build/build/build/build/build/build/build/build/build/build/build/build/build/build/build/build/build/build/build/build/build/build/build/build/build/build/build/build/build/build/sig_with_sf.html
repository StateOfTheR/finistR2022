<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Pierre Barbillon, Anna Bonnet, Pierre Gloaguen" />

<meta name="date" content="2022-08-23" />

<title>SIG avec SF</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Finist'R 2022</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://github.com/StateOfTheR/finistR2022">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Workflow
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="introDockeR.html">Docker</a>
    </li>
    <li>
      <a href="rebase.html">Git avancé</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-brands fa-r-project"></span>
     
    Langage R et pipe
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pipe.html">pipe</a>
    </li>
    <li>
      <a href="webscraping.html">Webscrapping</a>
    </li>
    <li>
      <a href="extensionShiny.html">Shiny extension</a>
    </li>
    <li>
      <a href="sig_with_sf.html">R et SIG</a>
    </li>
  </ul>
</li>
<li>
  <a href="autodiff.html">Différention automatique</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">SIG avec SF</h1>
<h4 class="author">Pierre Barbillon, Anna Bonnet, Pierre Gloaguen</h4>
<h4 class="date">2022-08-23</h4>

</div>


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="référence" class="section level1">
<h1>Référence</h1>
<p>Ce petit tutoriel décrit l’usage basique de <code>sf</code>, les
exemples sont extraits de <a
href="https://rcarto.github.io/geomatique_avec_r/index.html">ce tutoriel
complet</a> (qui n’utilise cependant pas la logique
<code>tidyverse</code>).</p>
</div>
<div id="données" class="section level1">
<h1>Données</h1>
<p>Les données utilisées sont issues de ce <a
href="https://rcarto.github.io/geomatique_avec_r/">tutoriel sur la
géomatique avec R</a> et accessible sur leur répertoire
<code>Github</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>communes <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;https://github.com/rCarto/geomatique_avec_r/blob/main/data/lot46.gpkg?raw=true&quot;</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">layer=</span><span class="st">&quot;commune&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `commune&#39; from data source 
##   `https://github.com/rCarto/geomatique_avec_r/blob/main/data/lot46.gpkg?raw=true&#39; 
##   using driver `GPKG&#39;
## Simple feature collection with 313 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 539668.5 ymin: 6346290 xmax: 637380.9 ymax: 6439668
## Projected CRS: RGF93 / Lambert-93</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>route <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;https://github.com/rCarto/geomatique_avec_r/blob/main/data/lot46.gpkg?raw=true&quot;</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">&quot;route&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="objets-sf" class="section level1">
<h1>Objets <code>sf</code></h1>
<p>La première étape est de caractériser ces objets spatiaux. Ces objets
sont de la classe <code>sf</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is</span>(communes)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;       &quot;oldClass&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is</span>(route)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;       &quot;oldClass&quot;</code></pre>
<p>Un objet <code>sf</code> est un tableau qui se manipulera comme un
<code>data.frame</code>. Cependant, l’objet <code>sf</code> a la
caractéristique de contenir une colonne <code>geometry</code> qui donne
les coordonnées de l’objet géographique. Cet objet géographique peut
être</p>
<ul>
<li>un point;</li>
<li>une ligne;</li>
<li>un polygone;</li>
<li>un ensemble de polygones (<code>MULTIPOLYGON</code>);</li>
<li>etc… (on trouvera le descriptif des formats <a
href="https://r-spatial.github.io/sf/articles/sf1.html">ici</a>)</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>communes</span></code></pre></div>
<pre><code>## Simple feature collection with 313 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 539668.5 ymin: 6346290 xmax: 637380.9 ymax: 6439668
## Projected CRS: RGF93 / Lambert-93
## First 10 features:
##    INSEE_COM         NOM_COM         STATUT POPULATION     AGR_H    AGR_F
## 1      46001           Albas Commune simple        522  4.978581 0.000000
## 2      46002          Albiac Commune simple         67  0.000000 9.589041
## 3      46003        Alvignac Commune simple        706 10.419682 0.000000
## 4      46004         Anglars Commune simple        219  0.000000 0.000000
## 5      46005 Anglars-Juillac Commune simple        329  4.894895 4.894895
## 6      46006   Anglars-Nozac Commune simple        377  4.840849 0.000000
## 7      46007        Arcambal Commune simple        988 10.126317 0.000000
## 8      46008      Les Arques Commune simple        203  0.000000 0.000000
## 9      46009          Assier Commune simple        642 10.194444 0.000000
## 10     46010          Aujols Commune simple        367  0.000000 0.000000
##        IND_H     IND_F     BTP_H    BTP_F     TER_H      TER_F
## 1   4.936153  0.000000  9.957527 0.000000 44.917145  34.681799
## 2   0.000000  0.000000  4.794521 0.000000  4.794521   9.589041
## 3  10.419682  5.209841 10.419682 0.000000 57.308249  78.147612
## 4  20.000000 15.000000 10.000000 0.000000 20.000000  20.000000
## 5   4.894895  0.000000  0.000000 0.000000 29.369369  29.369369
## 6   0.000000  0.000000  9.681698 4.840849 43.567639  38.726790
## 7  60.757902 10.126317 40.505268 5.063158 55.694743 121.515804
## 8   4.924242  0.000000  0.000000 0.000000  9.848485   9.848485
## 9  49.006029 14.996466 14.649874 0.000000 19.692951  68.227761
## 10  9.837838  0.000000 24.594595 0.000000 24.594595  63.945946
##                              geom
## 1  MULTIPOLYGON (((559262 6371...
## 2  MULTIPOLYGON (((605540.7 64...
## 3  MULTIPOLYGON (((593707.7 64...
## 4  MULTIPOLYGON (((613211.3 64...
## 5  MULTIPOLYGON (((556744.9 63...
## 6  MULTIPOLYGON (((576667.2 64...
## 7  MULTIPOLYGON (((581404 6370...
## 8  MULTIPOLYGON (((558216 6389...
## 9  MULTIPOLYGON (((612729.6 63...
## 10 MULTIPOLYGON (((581404 6370...</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>route</span></code></pre></div>
<pre><code>## Simple feature collection with 16096 features and 17 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: 539670.7 ymin: 6346010 xmax: 637504.4 ymax: 6440193
## Projected CRS: RGF93 / Lambert-93
## First 10 features:
##                          ID           VOCATION NB_CHAUSSE NB_VOIES   ETAT ACCES
## 1  BDCTRORO0000000021289990     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 2  BDCTRORO0000000021290017     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 3  BDCTRORO0000000021326471     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 4  BDCTRORO0000000021328689     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 5  BDCTRORO0000000202866717  Liaison régionale 1 chaussée   1 voie Revêtu Libre
## 6  BDCTRORO0000000021272608     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 7  BDCTRORO0000000021272607 Liaison principale 1 chaussée  2 voies Revêtu Libre
## 8  BDCTRORO0000000021337059  Liaison régionale 1 chaussée   1 voie Revêtu Libre
## 9  BDCTRORO0000000021346024     Liaison locale 1 chaussée   1 voie Revêtu Libre
## 10 BDCTRORO0000000021328392     Liaison locale 1 chaussée   1 voie Revêtu Libre
##    POS_SOL RES_VERT        SENS NB_VOIES_M NB_VOIES_D TOPONYME
## 1   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 2   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 3   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 4   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 5   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 6   Au sol      Non Sens direct Sans objet Sans objet     &lt;NA&gt;
## 7   Au sol      Oui Double sens Sans objet Sans objet     &lt;NA&gt;
## 8   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 9   Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
## 10  Au sol      Non Double sens Sans objet Sans objet     &lt;NA&gt;
##                        USAGE       DATE NUM_ROUTE      CLASS_ADM GEST_ROUTE
## 1  Logique et cartographique 2021-05-07      D258 Départementale         46
## 2  Logique et cartographique 2021-05-07      D205 Départementale         46
## 3  Logique et cartographique 2021-05-07      D158 Départementale         46
## 4  Logique et cartographique 2021-05-07      D158 Départementale         46
## 5  Logique et cartographique 2021-05-07       D13 Départementale         46
## 6  Logique et cartographique 2021-05-07      D105 Départementale         46
## 7  Logique et cartographique 2021-05-07      D820 Départementale         46
## 8  Logique et cartographique 2021-05-07       D19 Départementale         46
## 9  Logique et cartographique 2021-05-07       D79 Départementale         46
## 10 Logique et cartographique 2021-05-07       D18 Départementale         46
##                              geom
## 1  LINESTRING (622828.5 640887...
## 2  LINESTRING (614776.4 640763...
## 3  LINESTRING (542094.5 638394...
## 4  LINESTRING (541643.5 638172...
## 5  LINESTRING (578592.6 638806...
## 6  LINESTRING (577875.7 641786...
## 7  LINESTRING (577923 6417959,...
## 8  LINESTRING (606816.7 637497...
## 9  LINESTRING (608857.1 636793...
## 10 LINESTRING (616840.6 638151...</code></pre>
<p>Chaque champ de cette colonne <code>geometry</code> est un ensemble
de valeurs numériques exprimées dans un système de référence, le
<em>coordinate reference system</em> (CRS). Pour trouver le CRS adapté à
sa zone, on pourra consulter <a
href="https://fr.wikipedia.org/wiki/Transverse_universelle_de_Mercator#top-page">cette
page</a>.</p>
<p>Pour la France, le CRS 2154 est une bonne (au sens du respect des
distances après projection) approximation à l’échelle du territoire
métropolitaine.</p>
</div>
<div id="mise-au-format-sf" class="section level1">
<h1>Mise au format <code>sf</code></h1>
<p>Les objets précédents étant nativement des “objets géographiques”, on
les chargeait directement avec <code>st_read</code> (formats
<code>.shp</code>, <code>.gpkg</code>, possibles). Cependant, on peut
transformer un tableau ayant deux colonnes de coordonnées grâce à la
fonction <code>st_as_sf</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau classique</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>population_brute <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://github.com/rCarto/geomatique_avec_r/raw/main/data/pop.csv&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(population_brute) <span class="co"># Les colonnes x et y sont déjà en CRS(2154)</span></span></code></pre></div>
<pre><code>##         x       y  Ind
## 1 3630500 2383500 23.0
## 2 3629500 2384500 25.0
## 3 3630500 2384500 18.0
## 4 3631500 2384500 11.5
## 5 3644500 2384500  5.0
## 6 3645500 2384500  9.0</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(population_brute, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="co"># Spécification des coordonnées</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">2154</span>)) <span class="co"># On utilise st_crs pour specifier un CRS</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>population</span></code></pre></div>
<pre><code>## Simple feature collection with 4595 features and 1 field
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 3604500 ymin: 2383500 xmax: 3702500 ymax: 2475500
## Projected CRS: RGF93 / Lambert-93
## First 10 features:
##     Ind                geometry
## 1  23.0 POINT (3630500 2383500)
## 2  25.0 POINT (3629500 2384500)
## 3  18.0 POINT (3630500 2384500)
## 4  11.5 POINT (3631500 2384500)
## 5   5.0 POINT (3644500 2384500)
## 6   9.0 POINT (3645500 2384500)
## 7  16.0 POINT (3646500 2384500)
## 8  67.0 POINT (3648500 2384500)
## 9   8.0 POINT (3629500 2385500)
## 10 11.0 POINT (3630500 2385500)</code></pre>
</div>
<div id="manipulation-et-visualisation" class="section level1">
<h1>Manipulation et visualisation</h1>
<p>La manipulation et la visualisation sont calquées sur celles des
<code>data.frame</code>. On pourra utiliser tous les verbes de
<code>dplyr</code>.</p>
<p>Par exemple, si on veut obtenir la commune ayant la plus grande
population</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(communes, POPULATION <span class="sc">==</span> <span class="fu">max</span>(POPULATION)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NOM_COM, POPULATION) <span class="co"># On note que la colonne geometry est conservé!</span></span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 570470.4 ymin: 6368056 xmax: 581068.4 ymax: 6380468
## Projected CRS: RGF93 / Lambert-93
##   NOM_COM POPULATION                           geom
## 1  Cahors      19907 MULTIPOLYGON (((580994.5 63...</code></pre>
<p>Pour la représentation graphique, on pourra utiliser le
<code>plot</code> natif ou, si l’on préfère, se servir de
<code>ggplot2</code> et de la fonction dédiée <code>geom_sf</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(communes)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_communes_plot-1.png" width="672" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique basique des polygones</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/communes_ggplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout d&#39;un attribut du tableau</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> POPULATION)) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/communes_ggplot-2.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout d&#39;un 2e objet sf</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> route, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/communes_ggplot-3.png" width="672" /></p>
</div>
<div id="manipulations-spatiales" class="section level1">
<h1>Manipulations spatiales</h1>
<p><code>sf</code> propose une série de fonctions (ou <em>verbes</em>
commençant par le préfixe <code>st_</code>). Par exemple,
<code>st_bbox</code> extrait le rectangle entourant un objet
géométrique.</p>
<div id="st_intersects" class="section level2">
<h2><code>st_intersects</code></h2>
<p>Ici, si on veut isoler les routes qui traversent la commune de Gramat
et la représenter. On utilise ici <code>st_intersects</code> qui établit
si un un ensemble de <code>geometry</code> (dans l’argument
<code>x</code>) intersecte un ou plusieurs <code>geometry</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gramat <span class="ot">&lt;-</span> <span class="fu">filter</span>(communes, NOM_COM <span class="sc">==</span> <span class="st">&quot;Gramat&quot;</span>) <span class="co"># On extrait la commune Gramat</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>limites_gramat <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(gramat) <span class="co"># On en extrait ses limites</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On s&#39;intéresse aux routes qui traversent Gramat, où ici, st_intersects renvoie </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># un vecteur de booleens (c&#39;est le role de sparse = FALSE) indiquant pour chaque</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># route si elle traverse ou non Gramat.</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>routes_gramat <span class="ot">&lt;-</span> <span class="fu">filter</span>(route, <span class="fu">st_intersects</span>(route, gramat, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut faire la représentation graphique.</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> route, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Hors Gramat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_gramat, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Traversant Gramat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Commune de Gramat&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> limites_gramat[<span class="fu">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> limites_gramat[<span class="fu">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_plot_communes_gramat-1.png" width="672" /></p>
</div>
<div id="st_within" class="section level2">
<h2><code>st_within</code></h2>
<p>Si on ne souhaite que les routes <strong>à l’intérieur</strong> de la
commune, on utilise <code>st_within</code></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>routes_dans_gramat <span class="ot">&lt;-</span> <span class="fu">filter</span>(route, <span class="fu">st_within</span>(route, gramat, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut faire la représentation graphique.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> route, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Hors Gramat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_dans_gramat, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;Traversant Gramat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Commune de Gramat&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> limites_gramat[<span class="fu">c</span>(<span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;xmax&quot;</span>)], </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> limites_gramat[<span class="fu">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;ymax&quot;</span>)])</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_plot_routes_dans_gramat-1.png" width="672" /></p>
</div>
<div id="unions" class="section level2">
<h2>Unions</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>restaurants_complet <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;https://github.com/rCarto/geomatique_avec_r/blob/main/data/lot46.gpkg?raw=true&quot;</span>, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">&quot;restaurant&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>On a importé la liste des restaurants de la région. On voit
ci-dessous que nombre d’entre eux sont en dehors du Lot.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> restaurants_complet, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Positions des restaurants&quot;</span>)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_plot_restaurants-1.png" width="672" /></p>
<p>Ainsi, on souhaite ne conserver que ceux sont qui sont dans notre
ensemble de communes. On utilisera à nouveau <code>st_intersects</code>,
mais ici on ne veut pas que le test se fasse pour chaque commune! Ainsi,
on regroupera toutes les communes en un seul polygone avec
<code>st_union</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>restaurant <span class="ot">&lt;-</span> <span class="fu">filter</span>(restaurants_complet,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">st_intersects</span>(restaurants_complet,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">st_union</span>(communes),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> restaurant, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Positions des restaurants du Lot&quot;</span>)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_plot_restaurants_filtres-1.png" width="672" /></p>
</div>
<div id="barycentres-et-buffers" class="section level2">
<h2>Barycentres et buffers</h2>
<p>On peut obtenir le barycentre d’un polygon et/ou faire un
<em>buffer</em> autour d’un objet géométrique.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>buffer_gramat <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(gramat) <span class="sc">%&gt;%</span> <span class="co"># On extrait le centre de gravité </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">15000</span>) <span class="co"># On fait le disque centré en ce point, de rayon 15km </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Représentation</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(buffer_gramat) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> communes) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_centroid-1.png" width="672" /></p>
</div>
<div id="exercices" class="section level2">
<h2>Exercices</h2>
<p>Afin de s’entraîner, nous avons répondu aux exercices proposés dans
le tutoriel <strong>Géomatique avec <code>R</code></strong> cité plus
haut.</p>
<ol style="list-style-type: decimal">
<li>Quelles communes ont plus de 10 restaurants et moins de 1000
habitants ?</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Villages de France</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>VdF <span class="ot">&lt;-</span> communes <span class="sc">%&gt;%</span> <span class="co"># Dans communes</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(POPULATION <span class="sc">&lt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="co"># On extrait celles ayant &lt; de 1000 habitants</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NbResto =</span> <span class="fu">st_intersects</span>(., restaurant) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sapply</span>(length)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NbResto <span class="sc">&gt;=</span> <span class="dv">10</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pull</span>(VdF, NOM_COM)</span></code></pre></div>
<pre><code>## [1] &quot;Rocamadour&quot;         &quot;Saint-Cirq-Lapopie&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Les représenter sur une carte</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(communes) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> VdF, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="at">data =</span> VdF, <span class="fu">aes</span>(<span class="at">label =</span> NOM_COM), <span class="at">nudge_x =</span> <span class="dv">20000</span>)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/representation_graphique-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Intersecter les routes par les communes Découper les routes par les
communes. Chaque segment de route récupère l’identifiant de la commune
dans laquelle il se trouve. Rajouter une colonne longueur qui contient
la longueur de chacun des segments.</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>routes_communes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(route, communes) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(ID <span class="sc">==</span> <span class="fu">paste</span>(NUM_ROUTE, NOM_COM)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, NUM_ROUTE, NOM_COM) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">longueur =</span> <span class="fu">st_length</span>(.))</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<ul>
<li>Calculer la longueur totale de route par commune;</li>
<li>Joindre ses longueurs à la table des communes;</li>
<li>Calculer les superficies des communes;</li>
<li>Convertir</li>
<li>Calculer les 2 indicateurs suivants:
<ul>
<li>le rapport entre la longueur des routes et la population des
communes.</li>
<li>le rapport entre la longueur des routes et la superficie des
communes.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>indicateur_communes <span class="ot">&lt;-</span> routes_communes <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NOM_COM) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">longueur_totale_route =</span> <span class="fu">sum</span>(longueur) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="co"># Mise en km </span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  <span class="co"># Ici, on veut faire une jointure, donc on se débarasse de la geometry</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(communes) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> <span class="co"># Le merge perd le statut sf? A explorer...</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surface =</span> <span class="fu">st_area</span>(.) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>),<span class="co"># Création des nouvelles</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">longueur_par_habitant =</span> longueur_totale_route <span class="sc">/</span> POPULATION, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">longueur_par_km2 =</span> longueur_totale_route <span class="sc">/</span> surface) <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NOM_COM, longueur_totale_route, longueur_par_habitant, longueur_par_km2)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Représenter les deux indicateurs</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(indicateur_communes) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.numeric</span>(longueur_par_habitant))) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> route, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Longueur de route par habitant&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(indicateur_communes) <span class="sc">+</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.numeric</span>(longueur_par_km2))) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> route, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Longueur de route par km2&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2)</span></code></pre></div>
<p><img src="sig_with_sf_files/figure-html/sig_plot_indicateur_communes-1.png" width="672" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
